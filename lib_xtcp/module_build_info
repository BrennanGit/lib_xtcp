VERSION = 6.0.0

DEPENDENT_MODULES = lib_ethernet(>=3.2.0) lib_otpinfo(>=2.0.0) lib_crypto(>=1.0.0)

# Build flags
MODULE_XCC_FLAGS = $(XCC_FLAGS) -DLWIP=1 -DUIP=2
MODULE_XCC_C_FLAGS = $(XCC_C_FLAGS) -Wno-ignored-attributes -Wno-typedef-redefinition -DUNSAFE_LIBC -Os
MODULE_XCC_XC_FLAGS = $(XCC_XC_FLAGS) -DUNSAFE_LIBC -Os

# Source directories
# Note: only includes IPv4 of lwIP
LWIP_SOURCE_DIRS = src src/xtcp_lwip/api src/xtcp_lwip/core/ src/xtcp_lwip/core/ipv4 src/xtcp_lwip/netif src/xtcp_lwip/xcore/src
UIP_SOURCE_DIRS  = src src/xtcp_uip/*
MBEDTLS_SOURCE_DIRS = src/xtcp_mbedtls/library

# Include directories
LWIP_INCLUDE_DIRS = src src/xtcp_lwip/include src/xtcp_lwip/xcore/include
MBEDTLS_INCLUDE_DIRS = src src/xtcp_mbedtls/include

# Exclude files
UIP_EXCLUDE_FILES  += uip-fw.c uip-neighbor.c xtcp_lwip.xc xtcp_lwip_includes.h
LWIP_EXCLUDE_FILES += xtcp_uip.xc xtcp_uip_includes.h

# Leftover from previous incarnation.
XCC_FLAGS_xcoredev.xc = $(XCC_XC_FLAGS) -fsubword-select


# Default to UIP
ifndef XTCP_STACK
XTCP_STACK = UIP
endif

ifeq ($(XTCP_STACK), UIP)
SOURCE_DIRS   += $(UIP_SOURCE_DIRS)
INCLUDE_DIRS  += $(UIP_SOURCE_DIRS) api
EXCLUDE_FILES += $(UIP_EXCLUDE_FILES)
# Defined in program
MODULE_XCC_FLAGS += -DXTCP_STACK=UIP

else ifeq ($(XTCP_STACK), LWIP)
SOURCE_DIRS   += $(LWIP_SOURCE_DIRS)
INCLUDE_DIRS  += $(LWIP_INCLUDE_DIRS) api
EXCLUDE_FILES += $(LWIP_EXCLUDE_FILES)
# Defined in program
MODULE_XCC_FLAGS += -DXTCP_STACK=LWIP

else
$(error XTCP_STACK must be either UIP or LWIP (or undefined, which defaults to UIP))

endif